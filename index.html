<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>SPECTRE Analysis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="style.css" rel="stylesheet" />
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
</head>

<body>
    <header>
        <h1>SPECTRE Analysis</h1>

        <div class="toolbar">
            <!-- UMAP variant tabs act as toggles (can be none) -->
            <div class="group">
                <nav class="tabs sub" role="tablist" aria-label="UMAP variants">
                    <button id="tab-CLS" role="tab" aria-selected="true" data-tab="CLS">CLS UMAP</button>
                    <button id="tab-TANI" role="tab" aria-selected="false" data-tab="TANI">Tanimoto UMAP</button>
                </nav>
            </div>

            <div class="vsep" role="separator" aria-orientation="vertical" aria-hidden="true"></div>

            <!-- Accuracy metric tabs act as toggles (can be none) -->
            <div class="group">
                <nav class="tabs sub" role="tablist" aria-label="Accuracy metrics">
                    <button id="acc-R1" role="tab" aria-selected="false" data-acc="R1">Rank-1</button>
                    <button id="acc-MEAN" role="tab" aria-selected="false" data-acc="MEAN">Mean-rank</button>
                    <button id="acc-TANIS" role="tab" aria-selected="false" data-acc="TANIS">Tanimoto</button>
                </nav>
            </div>

            <!-- (hidden) manual loaders kept in DOM to avoid JS edits -->
            <div class="group file-controls" hidden>
                <label class="file-btn">
                    Load UMAP CSV
                    <input id="file-input-umap" type="file" accept=".csv" hidden />
                </label>
                <label class="file-btn">
                    Load Accuracy CSV
                    <input id="file-input-acc" type="file" accept=".csv" hidden />
                </label>
                <button id="use-sample-umap" title="Sample UMAP">Sample UMAP</button>
                <button id="use-sample-acc" title="Sample Accuracy">Sample Accuracy</button>
            </div>
        </div>
        <div class="group">
            <button id="help-btn" class="help-btn" aria-controls="help-drawer" aria-expanded="false"
                title="Help (press ?)">
                Help
            </button>
        </div>
    </header>

    <main>
        <aside id="sidebar">
            <!-- UMAP controls -->
            <div id="umap-controls">
                <div class="section">
                    <h2>Search</h2>
                    <input id="search-input" type="text" placeholder="Filter classes…" />
                </div>

                <div class="section">
                    <h2>NP Superclasses</h2>
                    <div id="class-checklist" class="checklist"></div>
                </div>

                <div class="section">
                    <h2>Point Styling</h2>
                    <label>Size
                        <input id="point-size" type="range" min="2" max="12" value="5" />
                    </label>
                    <label>Unselected Opacity
                        <input id="dim-opacity" type="range" min="0" max="0.8" step="0.05" value="0.12" />
                    </label>
                    <label class="toggle">
                        <input id="hide-unselected" type="checkbox" />
                        Hide unselected (instead of dim)
                    </label>
                </div>

                <footer>
                    <small>
                        UMAP CSV: <code>umap_x, umap_y, superclass</code><br />
                        Accuracy CSV: <code>superclass, value[, n]</code><br />
                        Auto-loads from <code>/data/*.csv</code>
                    </small>
                </footer>
            </div>

            <!-- Accuracy controls -->
            <div id="acc-controls">
                <div class="section">
                    <h2>Bar Options</h2>
                    <label class="toggle">
                        <input id="sort-desc" type="checkbox" checked />
                        Sort by value (desc)
                    </label>
                    <label class="toggle">
                        <input id="show-n" type="checkbox" checked />
                        Show sample size in labels
                    </label>
                    <label>
                        Top-K by count
                        <input id="topk" type="number" min="1" max="200" step="1" value="20" />
                    </label>
                </div>
            </div>
        </aside>

        <!-- Split panes; divider appears only when both visible -->
        <section id="panes" class="panes single">
            <div id="pane-umap" class="pane">
                <div id="plot-umap"></div>
                <div id="status-umap" class="panel-status" aria-live="polite"></div>
            </div>

            <div id="divider" class="divider" hidden aria-hidden="true"></div>

            <div id="pane-acc" class="pane" hidden>
                <div id="plot-acc"></div>
                <div id="status-acc" class="panel-status" aria-live="polite"></div>
            </div>

            <div id="pane-blank" class="pane placeholder" hidden aria-hidden="true">
                <div class="placeholder-inner">
                    <h3>No plots selected</h3>
                    <p>Select a <strong>UMAP</strong> or an <strong>Accuracy</strong> tab above to begin.</p>
                </div>
            </div>
        </section>
        <section id="metrics" aria-label="Clustering metrics">
            <h2>Clustering Metrics</h2>

            <div id="metrics-grid">
                <!-- Left: metric selector + plot -->
                <div id="metrics-left">
                    <nav id="metric-tabs" class="tabs sub" role="tablist" aria-label="Metric options">
                        <!-- buttons injected by JS based on selected UMAP -->
                    </nav>
                    <div id="metrics-plot"></div>
                </div>

                <!-- Right: explanation -->
                <aside id="metrics-right">
                    <div id="metric-desc" class="metric-desc">
                        <em>Select a metric above to see its definition and interpretation.</em>
                    </div>
                </aside>
            </div>
        </section>
        <!-- ===== Composition & NMR Summaries ===== -->
        <section id="chem" aria-label="Composition & NMR summaries">
            <h2>Composition & NMR Summaries</h2>

            <div id="chem-grid">
                <!-- Left: mini sidebar -->
                <aside id="chem-side">
                    <div class="section">
                        <h3>Show Top-K (by items)</h3>
                        <input id="chem-topk" type="number" min="1" max="300" step="1" value="20" />
                    </div>

                    <div class="section">
                        <h3>Metric</h3>
                        <nav id="chem-tabs" class="tabs sub" role="tablist" aria-label="Chem metrics"
                            aria-orientation="vertical">

                        </nav>
                    </div>
                </aside>

                <!-- Right: plot + explanation -->
                <div id="chem-main">
                    <div id="chem-plot"></div>
                    <aside id="chem-desc" class="metric-desc">
                        <em>Select a metric to see its definition and interpretation.</em>
                    </aside>
                </div>
            </div>
        </section>
        <!-- ==================== Confusion Matrix ==================== -->
        <section id="conf" aria-label="Confusion matrix">
            <h2>Confusion Matrix</h2>

            <div id="conf-grid">
                <!-- Left: matrix plot -->
                <div id="conf-left">
                    <div id="conf-plot"></div>
                </div>

                <!-- Right: controls & explainer -->
                <aside id="conf-right">
                    <div class="section">
                        <h3>Retrieval k</h3>
                        <nav id="cm-k-tabs" class="tabs vstack" role="tablist" aria-label="Retrieval k">
                            <button type="button" data-k="1" aria-selected="true">k = 1</button>
                            <button type="button" data-k="5" aria-selected="false">k = 5</button>
                            <button type="button" data-k="10" aria-selected="false">k = 10</button>
                        </nav>
                    </div>

                    <div class="section">
                        <h3>Values</h3>
                        <nav id="cm-mode-tabs" class="tabs vstack" role="tablist" aria-label="Value mode">
                            <button type="button" data-mode="row" aria-selected="true">Row-normalized</button>
                            <button type="button" data-mode="counts" aria-selected="false">Counts</button>
                        </nav>
                    </div>

                    <div class="section">
                        <label>
                            Show Top-K classes (by count)
                            <input id="cm-topk" type="number" min="1" max="120" value="20" />
                        </label>
                    </div>

                    <div class="section infobox">
                        <h3>How to read</h3>
                        <p><strong>Rows</strong> = true class, <strong>Columns</strong> = predicted class.</p>
                        <p>Top-K limits rows/columns to the most frequent classes and collapses the rest into
                            <strong>Other</strong> so totals are preserved.</p>
                    </div>
                </aside>
            </div>
        </section>


    </main>

    <script src="app.js"></script>

    <!-- Help Drawer -->
    <aside id="help-drawer" class="help-drawer" role="dialog" aria-modal="true" aria-hidden="true"
        aria-labelledby="help-title" tabindex="-1">
        <header class="help-drawer__header">
            <button id="help-close" class="help-close" aria-label="Close help">✕</button>
            <h2 id="help-title">How to use this dashboard</h2>
        </header>

        <div class="help-drawer__body">
<h3>Tabs</h3>
<ul>
  <li><strong>CLS UMAP / Tanimoto UMAP</strong> — toggle to show the corresponding scatter plot. When a UMAP is active, the <em>Clustering Metrics</em> section appears.</li>
  <li><strong>Rank-1 / Mean-rank / Tanimoto</strong> — shows the accuracy bar chart for that metric.</li>
  <li><strong>Chem / NMR</strong> — vertical buttons on the right choose which summary metric to plot (Avg. Carbons, Hydrogens, HSQC / 13C NMR / 1H NMR peaks).</li>
  <li><strong>Confusion Matrix</strong> — select <em>k</em> (1/5/10) and <em>Mode</em> (Row-normalized or Counts) via vertical button groups on the right.</li>
</ul>

<h3>Sidebar (UMAP)</h3>
<ul>
  <li><strong>Search</strong> — filter the class checklist.</li>
  <li><strong>NP Superclasses</strong> — check classes to highlight; uncheck to dim/hide. <em>Hover</em> a class in any plot to temporarily highlight it everywhere.</li>
  <li><strong>Point Styling</strong> — adjust point size & unselected opacity, or <em>Hide unselected</em> entirely.</li>
  <li><strong>Top-K by count</strong> — limits visible classes to the K most frequent; affects UMAP, Accuracy bars, Metrics, and Chem/NMR lists.</li>
</ul>

<h3>Sidebar (Accuracy)</h3>
<ul>
  <li><strong>Sort by value</strong> — toggle descending/ascending.</li>
  <li><strong>Show sample size</strong> — appends <code>(n=…)</code> to each label.</li>
  <li><strong>Top-K by count</strong> — caps the chart to the K largest classes (panel scrolls if tall).</li>
</ul>

<h3>Clustering Metrics</h3>
<ul>
  <li>Choose a metric tab (e.g. Silhouette) to see a per-class bar chart with matching class colors.</li>
  <li>The info card explains what the metric means and whether higher or lower is better.</li>
  <li>Labels auto-shrink when many classes are shown; use Top-K to reduce clutter.</li>
</ul>

<h3>Chemical Composition & NMR</h3>
<ul>
  <li>Use the <strong>vertical metric selector</strong> to plot: Avg. # Carbons, Avg. # Hydrogens, Avg. # Peaks (HSQC / 13C NMR / 1H NMR).</li>
  <li><strong>Top-K</strong> limits to the most frequent classes; colors match the global palette used in UMAP/Accuracy.</li>
</ul>

<h3>Confusion Matrix</h3>
<ul>
  <li>Select <strong>k</strong> (1, 5, or 10) and <strong>Mode</strong> (Row-normalized or Counts) from the <em>right-hand sidebar</em>.</li>
  <li><strong>Top-K classes</strong> shows the K most frequent classes; all others are aggregated into an <em>Other</em> row/column so no information is lost.</li>
  <li>Axis labels auto-shrink/rotate as needed; the matrix panel scrolls if large.</li>
</ul>

<h3>Layout tips</h3>
<ul>
  <li>Drag the center divider to resize UMAP vs Accuracy when both are shown.</li>
  <li>Panels scroll if content exceeds the viewport; labels shrink dynamically when crowded.</li>
</ul>

<h3>Shortcuts</h3>
<ul>
  <li><strong>Esc</strong>: close help</li>
</ul>

        </div>
    </aside>

    <!-- Dim overlay (click to close) -->
    <div id="help-overlay" class="help-overlay" hidden></div>

</body>

</html>